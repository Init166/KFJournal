{% extends 'base.html' %}
{% load static %}
{% load student_extras %}

{% block title %}–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ{% endblock %}

{% block content %}
<div>
    <!-- –®–∞–ø–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–µ–¥–µ–ª–µ -->
    <div class="card-custom mb-4" style="background: linear-gradient(135deg, #28a745, #20c997); color: white;">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3">
            <div>
                <h1 class="h2 fw-bold mb-2">
                    <i class="bi bi-calendar-week me-2"></i>
                    –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                </h1>
                <p class="mb-0 opacity-75">
                    <i class="bi bi-building me-2"></i>–ì—Ä—É–ø–ø–∞: <strong>{{ group.name }}</strong>
                </p>
            </div>
            <div class="text-md-end">
                <div class="display-6 fw-bold">{{ current_week_display }} –Ω–µ–¥–µ–ª—è</div>
                <p class="mb-0 opacity-75">{{ today|date:"d.m.Y" }} - {{ monday|date:"d.m.Y" }}</p>
            </div>
        </div>
        
        <!-- –°—Ä–æ—á–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ —à–∞–ø–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
        {% if has_urgent %}
        <div class="alert alert-danger mt-3 mb-0 py-2">
            <i class="bi bi-megaphone-fill me-2"></i>
            <strong>–ï—Å—Ç—å –≤–∞–∂–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è!</strong> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        </div>
        {% endif %}
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (4 –∫–Ω–æ–ø–∫–∏) -->
    <div class="actions-grid mb-4">
        <button class="action-card {% if today_comments %}has-comments{% endif %}" onclick="showSection('today')" id="btn-today">
            <div class="action-icon" style="background: rgba(13,110,253,0.1); color: #0d6efd;">
                <i class="bi bi-calendar-day"></i>
                {% if today_comments %}
                <span class="comment-badge">!</span>
                {% endif %}
            </div>
            <div class="action-title">–°–µ–≥–æ–¥–Ω—è</div>
            <div class="action-desc">{{ today|date:"d.m" }}</div>
            {% if today_comments %}
            <div class="comment-indicator">üì¢</div>
            {% endif %}
        </button>
        
        <button class="action-card {% if tomorrow_comments %}has-comments{% endif %}" onclick="showSection('tomorrow')" id="btn-tomorrow">
            <div class="action-icon" style="background: rgba(255,193,7,0.1); color: #ffc107;">
                <i class="bi bi-calendar-plus"></i>
                {% if tomorrow_comments %}
                <span class="comment-badge">!</span>
                {% endif %}
            </div>
            <div class="action-title">–ó–∞–≤—Ç—Ä–∞</div>
            <div class="action-desc">{{ tomorrow|date:"d.m" }}</div>
            {% if tomorrow_comments %}
            <div class="comment-indicator">üì¢</div>
            {% endif %}
        </button>
        
        <button class="action-card" onclick="showSection('current-week')" id="btn-current-week">
            <div class="action-icon" style="background: rgba(40,167,69,0.1); color: #28a745;">
                <i class="bi bi-calendar-week"></i>
            </div>
            <div class="action-title">–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</div>
            <div class="action-desc">{{ current_week_display }}</div>
        </button>
        
        <button class="action-card" onclick="showSection('next-week')" id="btn-next-week">
            <div class="action-icon" style="background: rgba(111,66,193,0.1); color: #6f42c1;">
                <i class="bi bi-calendar2-week"></i>
            </div>
            <div class="action-title">–°–ª–µ–¥. –Ω–µ–¥–µ–ª—è</div>
            <div class="action-desc">{{ next_week_display }}</div>
        </button>
    </div>

    <!-- –ë–ª–æ–∫ —Å—Ä–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
    {% if comments %}
    <div class="card-custom mb-4 {% if has_urgent %}border-danger{% endif %}">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="section-title mb-0">
                <i class="bi bi-megaphone text-danger me-2"></i>
                –û–±—ä—è–≤–ª–µ–Ω–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                {% if has_urgent %}
                <span class="badge-custom badge-danger ms-2">–°—Ä–æ—á–Ω–æ!</span>
                {% endif %}
            </h3>
            <button class="btn btn-sm btn-outline-secondary" onclick="toggleCommentsSection()">
                <i class="bi bi-chevron-up" id="comments-icon"></i>
            </button>
        </div>
        
        <div id="comments-section">
            {% for comment in comments %}
            <div class="comment-item mb-2 {% if comment.is_urgent %}urgent{% endif %}">
                <div class="comment-meta">
                    <span>
                        <i class="bi bi-person-circle"></i> {{ comment.created_by.full_name|default:"–°—Ç–∞—Ä–æ—Å—Ç–∞" }}
                    </span>
                    <span class="comment-time">{{ comment.created_at|date:"d.m H:i" }}</span>
                </div>
                <div class="comment-text">{{ comment.comment }}</div>
                <div class="comment-context small text-muted mt-1">
                    {% if comment.date %}
                        <i class="bi bi-calendar"></i> {{ comment.date|date:"d.m.Y" }}
                    {% elif comment.day and comment.week_type %}
                        <i class="bi bi-calendar-week"></i> 
                        {% if comment.day == 1 %}–ü–Ω{% elif comment.day == 2 %}–í—Ç{% elif comment.day == 3 %}–°—Ä{% elif comment.day == 4 %}–ß—Ç{% elif comment.day == 5 %}–ü—Ç{% elif comment.day == 6 %}–°–±{% else %}–í—Å{% endif %},
                        {% if comment.week_type == 'even' %}—á—ë—Ç–Ω–∞—è{% else %}–Ω–µ—á—ë—Ç–Ω–∞—è{% endif %}
                    {% elif comment.week_type %}
                        <i class="bi bi-calendar-week"></i> –ù–∞ –≤—Å—é {% if comment.week_type == 'even' %}—á—ë—Ç–Ω—É—é{% else %}–Ω–µ—á—ë—Ç–Ω—É—é{% endif %} –Ω–µ–¥–µ–ª—é
                    {% else %}
                        <i class="bi bi-megaphone"></i> –û–±—â–µ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –Ω–∞ –∑–∞–≤—Ç—Ä–∞ -->
    {% if tomorrow_comments and not has_urgent %}
    <div class="alert alert-warning mb-4 py-2">
        <i class="bi bi-info-circle me-2"></i>
        <strong>–ù–∞ –∑–∞–≤—Ç—Ä–∞ –µ—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</strong> - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
    </div>
    {% endif %}

    <!-- –°–µ–∫—Ü–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->

    <!-- –°–µ–≥–æ–¥–Ω—è -->
<div class="card-custom mb-4 schedule-section" id="section-today">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="section-title mb-0">
            <i class="bi bi-calendar-day text-primary me-2"></i>
            –°–µ–≥–æ–¥–Ω—è, {{ today|date:"l, d.m.Y" }}
            <span class="badge-custom {% if current_week_type == 'even' %}badge-info{% else %}badge-warning{% endif %} ms-2">
                {{ current_week_display }}
            </span>
            {% if today_comments %}
            <span class="badge-custom badge-danger ms-2">
                <i class="bi bi-megaphone"></i> {{ today_comments|length }}
            </span>
            {% endif %}
        </h3>
        <button class="btn btn-sm btn-outline-secondary" onclick="toggleSection('today')">
            <i class="bi bi-chevron-up" id="icon-today"></i>
        </button>
    </div>
    
    <div class="section-content" id="content-today">
        {% if today_schedule %}
            {% for lesson in today_schedule %}
            <div class="lesson-card {% if lesson.has_comments %}has-comments{% endif %}">
                <div class="lesson-time">
                    {{ lesson.start_time }} - {{ lesson.end_time }}
                    <span class="badge-custom badge-info">{{ lesson.get_lesson_type_display }}</span>
                    {% if lesson.has_comments %}
                    <span class="badge-custom badge-danger ms-2">
                        <i class="bi bi-chat"></i> {{ lesson.lesson_comments|length }}
                    </span>
                    {% endif %}
                </div>
                <div class="lesson-subject">{{ lesson.subject }}</div>
                <div class="lesson-teacher"><i class="bi bi-person"></i> {{ lesson.teacher|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
                <div class="lesson-room"><i class="bi bi-door-open"></i> {{ lesson.room|default:"‚Äî" }}</div>
                
                <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–∞—Ä–µ -->
                {% if lesson.has_comments %}
                <div class="lesson-comments mt-2">
                    {% for comment in lesson.lesson_comments %}
                    <div class="comment-mini {% if comment.is_urgent %}urgent{% endif %}">
                        <div class="comment-mini-header">
                            <span class="comment-mini-author">
                                <i class="bi bi-person-circle"></i> {{ comment.created_by.full_name|default:"–°—Ç–∞—Ä–æ—Å—Ç–∞" }}
                            </span>
                            <span class="comment-mini-time">{{ comment.created_at|date:"H:i" }}</span>
                        </div>
                        <div class="comment-mini-text">{{ comment.comment }}</div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="text-center py-4">
                <i class="bi bi-emoji-smile display-4 text-muted"></i>
                <p class="mt-2">–°–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p>
            </div>
        {% endif %}
    </div>
</div>   

    <!-- –ó–∞–≤—Ç—Ä–∞ -->
    <div class="card-custom mb-4 schedule-section" id="section-tomorrow">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="section-title mb-0">
                <i class="bi bi-calendar-plus text-warning me-2"></i>
                –ó–∞–≤—Ç—Ä–∞, {{ tomorrow|date:"l, d.m.Y" }}
                <span class="badge-custom {% if tomorrow_week_type == 'even' %}badge-info{% else %}badge-warning{% endif %} ms-2">
                    {% if tomorrow_week_type == 'even' %}–ß—ë—Ç–Ω–∞—è{% else %}–ù–µ—á—ë—Ç–Ω–∞—è{% endif %}
                </span>
                {% if tomorrow_comments %}
                <span class="badge-custom badge-danger ms-2">
                    <i class="bi bi-megaphone"></i> –ï—Å—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
                </span>
                {% endif %}
            </h3>
            <button class="btn btn-sm btn-outline-secondary" onclick="toggleSection('tomorrow')">
                <i class="bi bi-chevron-up" id="icon-tomorrow"></i>
            </button>
        </div>
        
        <div class="section-content" id="content-tomorrow">
            {% if tomorrow_schedule %}
                {% for lesson in tomorrow_schedule %}
                <div class="lesson-card">
                    <div class="lesson-time">
                        {{ lesson.start_time }} - {{ lesson.end_time }}
                        <span class="badge-custom badge-info">{{ lesson.get_lesson_type_display }}</span>
                    </div>
                    <div class="lesson-subject">{{ lesson.subject }}</div>
                    <div class="lesson-teacher"><i class="bi bi-person"></i> {{ lesson.teacher|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
                    <div class="lesson-room"><i class="bi bi-door-open"></i> {{ lesson.room|default:"‚Äî" }}</div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-emoji-smile display-4 text-muted"></i>
                    <p class="mt-2">–ó–∞–≤—Ç—Ä–∞ –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- –≠—Ç–∞ –Ω–µ–¥–µ–ª—è -->
    <div class="card-custom mb-4 schedule-section" id="section-current-week">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="section-title mb-0">
                <i class="bi bi-calendar-week text-success me-2"></i>
                –¢–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è ({{ current_week_display }})
            </h3>
            <button class="btn btn-sm btn-outline-secondary" onclick="toggleSection('current-week')">
                <i class="bi bi-chevron-up" id="icon-current-week"></i>
            </button>
        </div>
        
        <div class="section-content" id="content-current-week">
            {% regroup current_week_schedule by day as day_list %}
            {% for day in day_list %}
            <div class="day-section mb-4">
                <h4 class="h6 fw-bold text-primary mb-3">
                    {% if day.grouper == 1 %}–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
                    {% elif day.grouper == 2 %}–í—Ç–æ—Ä–Ω–∏–∫
                    {% elif day.grouper == 3 %}–°—Ä–µ–¥–∞
                    {% elif day.grouper == 4 %}–ß–µ—Ç–≤–µ—Ä–≥
                    {% elif day.grouper == 5 %}–ü—è—Ç–Ω–∏—Ü–∞
                    {% elif day.grouper == 6 %}–°—É–±–±–æ—Ç–∞
                    {% elif day.grouper == 7 %}–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
                    {% endif %}
                </h4>
                
                {% for lesson in day.list|dictsort:"pair_number" %}
                <div class="lesson-card">
                    <div class="lesson-time">{{ lesson.start_time }} - {{ lesson.end_time }}</div>
                    <div class="lesson-subject">{{ lesson.subject }}</div>
                    <div class="lesson-teacher">{{ lesson.teacher|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
                    <div class="lesson-room">{{ lesson.room|default:"‚Äî" }}</div>
                </div>
                {% endfor %}
            </div>
            {% empty %}
            <div class="text-center py-4">
                <i class="bi bi-calendar-x display-4 text-muted"></i>
                <p class="mt-2">–ù–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è -->
    <div class="card-custom mb-4 schedule-section" id="section-next-week">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="section-title mb-0">
                <i class="bi bi-calendar2-week text-purple me-2"></i>
                –°–ª–µ–¥—É—é—â–∞—è –Ω–µ–¥–µ–ª—è ({{ next_week_display }})
            </h3>
            <button class="btn btn-sm btn-outline-secondary" onclick="toggleSection('next-week')">
                <i class="bi bi-chevron-up" id="icon-next-week"></i>
            </button>
        </div>
        
        <div class="section-content" id="content-next-week">
            {% regroup next_week_schedule by day as day_list %}
            {% for day in day_list %}
            <div class="day-section mb-4">
                <h4 class="h6 fw-bold text-purple mb-3">
                    {% if day.grouper == 1 %}–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
                    {% elif day.grouper == 2 %}–í—Ç–æ—Ä–Ω–∏–∫
                    {% elif day.grouper == 3 %}–°—Ä–µ–¥–∞
                    {% elif day.grouper == 4 %}–ß–µ—Ç–≤–µ—Ä–≥
                    {% elif day.grouper == 5 %}–ü—è—Ç–Ω–∏—Ü–∞
                    {% elif day.grouper == 6 %}–°—É–±–±–æ—Ç–∞
                    {% elif day.grouper == 7 %}–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
                    {% endif %}
                </h4>
                
                {% for lesson in day.list|dictsort:"pair_number" %}
                <div class="lesson-card">
                    <div class="lesson-time">{{ lesson.start_time }} - {{ lesson.end_time }}</div>
                    <div class="lesson-subject">{{ lesson.subject }}</div>
                    <div class="lesson-teacher">{{ lesson.teacher|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</div>
                    <div class="lesson-room">{{ lesson.room|default:"‚Äî" }}</div>
                </div>
                {% endfor %}
            </div>
            {% empty %}
            <div class="text-center py-4">
                <i class="bi bi-calendar-x display-4 text-muted"></i>
                <p class="mt-2">–ù–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <button class="btn btn-outline-secondary w-100 mb-3" onclick="toggleCalendar()" id="toggleCalendarBtn">
        <i class="bi bi-chevron-up"></i> –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å
    </button>
    
    <div class="card-custom mb-4" id="calendarSection" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="h5 fw-bold">{{ month_days.month_name }} {{ month_days.year }}</h3>
            <div>
                <button class="btn btn-sm btn-outline-secondary" onclick="changeMonth(-1)">‚Üê</button>
                <button class="btn btn-sm btn-outline-secondary" onclick="changeMonth(1)">‚Üí</button>
            </div>
        </div>
        
        <div class="calendar-grid">
            <div class="text-center text-muted small fw-bold py-2">–ü–Ω</div>
            <div class="text-center text-muted small fw-bold py-2">–í—Ç</div>
            <div class="text-center text-muted small fw-bold py-2">–°—Ä</div>
            <div class="text-center text-muted small fw-bold py-2">–ß—Ç</div>
            <div class="text-center text-muted small fw-bold py-2">–ü—Ç</div>
            <div class="text-center text-muted small fw-bold py-2">–°–±</div>
            <div class="text-center text-muted small fw-bold py-2">–í—Å</div>
            
            {% for _ in ""|ljust:month_days.first_day %}
            <div></div>
            {% endfor %}
            
            {% for day in month_days.days %}
            <div class="calendar-day {{ day.week_type }} 
                        {% if day.is_today %}today{% endif %}
                        {% if day.has_comments %}has-comment{% endif %}
                        {% if day.urgent_comments %}urgent-comment{% endif %}"
                 onclick="selectDate('{{ day.date|date:'Y-m-d' }}')"
                 title="{% if day.has_comments %}–ï—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏{% endif %}">
                {{ day.day }}
                {% if day.urgent_comments %}
                <span class="day-marker urgent">!</span>
                {% elif day.has_comments %}
                <span class="day-marker">‚Ä¢</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
        <div class="d-flex flex-wrap justify-content-center gap-4 mt-3">
            <div class="d-flex align-items-center">
                <div class="calendar-day even me-2" style="width: 20px; height: 20px;"></div>
                <small>–ß—ë—Ç–Ω–∞—è –Ω–µ–¥–µ–ª—è</small>
            </div>
            <div class="d-flex align-items-center">
                <div class="calendar-day odd me-2" style="width: 20px; height: 20px;"></div>
                <small>–ù–µ—á—ë—Ç–Ω–∞—è –Ω–µ–¥–µ–ª—è</small>
            </div>
            <div class="d-flex align-items-center">
                <div class="calendar-day today me-2" style="width: 20px; height: 20px;"></div>
                <small>–°–µ–≥–æ–¥–Ω—è</small>
            </div>
            <div class="d-flex align-items-center">
                <div class="calendar-day has-comment me-2" style="width: 20px; height: 20px; position: relative;">
                    <span class="day-marker" style="position: absolute; bottom: 0; right: 0;">‚Ä¢</span>
                </div>
                <small>–ï—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</small>
            </div>
        </div>
    </div>
</div>

<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ */
    .action-card.has-comments {
        position: relative;
        border: 2px solid #dc3545;
    }
    
    .comment-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        width: 20px;
        height: 20px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .comment-indicator {
        position: absolute;
        bottom: 5px;
        right: 5px;
        font-size: 14px;
    }
    
    .comment-item {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 10px;
        border-left: 4px solid #0d6efd;
    }
    
    .comment-item.urgent {
        background: #fff3cd;
        border-left-color: #dc3545;
    }
    
    .comment-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8rem;
        color: #6c757d;
        margin-bottom: 6px;
    }
    
    .comment-time {
        background: #e9ecef;
        padding: 2px 8px;
        border-radius: 12px;
    }
    
    .comment-text {
        font-size: 0.95rem;
        margin-bottom: 4px;
    }
    
    .comment-context {
        font-size: 0.75rem;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ */
    .calendar-day {
        position: relative;
    }
    
    .calendar-day.has-comment {
        border: 1px solid #0d6efd;
    }
    
    .calendar-day.urgent-comment {
        border: 2px solid #dc3545;
        font-weight: bold;
    }
    
    .day-marker {
        position: absolute;
        bottom: 2px;
        right: 2px;
        font-size: 12px;
        color: #0d6efd;
    }
    
    .day-marker.urgent {
        color: #dc3545;
        font-weight: bold;
    }
    
    /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ */
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
    }
    
    .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
    }
    
    .calendar-day.even {
        background: #e3f2fd;
        color: #1976d2;
    }
    
    .calendar-day.odd {
        background: #fff3e0;
        color: #f57c00;
    }
    
    .calendar-day.today {
        border: 2px solid #28a745;
        font-weight: bold;
    }
    
    .calendar-day:hover {
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .lesson-card {
        background: #f8f9fc;
        border-radius: 12px;
        padding: 12px 16px;
        margin-bottom: 8px;
        border-left: 4px solid #28a745;
        transition: all 0.2s;
    }
    
    .lesson-card:hover {
        background: white;
        box-shadow: 0 2px 8px rgba(40,167,69,0.1);
    }
    
    .lesson-time {
        font-size: 0.85rem;
        font-weight: 600;
        color: #28a745;
        margin-bottom: 4px;
    }
    
    .lesson-subject {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
    }
    
    .lesson-teacher, .lesson-room {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .text-purple {
        color: #6f42c1;
    }
    
    .action-card.active {
        border: 2px solid #28a745;
        transform: scale(1.02);
        box-shadow: 0 4px 12px rgba(40,167,69,0.2);
    }
    
    .action-card.active .action-icon {
        background: #28a745 !important;
        color: white !important;
    }
    
    @media (max-width: 768px) {
        .actions-grid {
            gap: 8px;
        }
        
        .action-card {
            padding: 12px 8px;
        }
        
        .action-icon {
            width: 40px;
            height: 40px;
            font-size: 20px;
        }
    }

.lesson-card.has-comments {
    border-left-color: #dc3545;
    background: #fff8f8;
}

.lesson-comments {
    border-top: 1px dashed #dee2e6;
    padding-top: 8px;
    margin-top: 8px;
}

.comment-mini {
    background: white;
    border-radius: 8px;
    padding: 6px 10px;
    margin-bottom: 4px;
    font-size: 0.85rem;
    border-left: 3px solid #0d6efd;
}

.comment-mini.urgent {
    border-left-color: #dc3545;
    background: #fff3cd;
}

.comment-mini-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.7rem;
    color: #6c757d;
    margin-bottom: 2px;
}

.comment-mini-author i {
    margin-right: 4px;
}

.comment-mini-time {
    background: #e9ecef;
    padding: 2px 6px;
    border-radius: 10px;
}

.comment-mini-text {
    font-size: 0.85rem;
}

    
</style>

<script>
    let activeSection = 'today';
    
    function showSection(sectionId) {
        document.querySelectorAll('.schedule-section').forEach(section => {
            section.style.display = 'none';
        });
        
        document.getElementById(`section-${sectionId}`).style.display = 'block';
        
        document.querySelectorAll('.action-card').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById(`btn-${sectionId}`).classList.add('active');
        
        activeSection = sectionId;
    }
    
    function toggleSection(sectionId) {
        const content = document.getElementById(`content-${sectionId}`);
        const icon = document.getElementById(`icon-${sectionId}`);
        
        if (content.style.display === 'none') {
            content.style.display = 'block';
            icon.className = 'bi bi-chevron-up';
        } else {
            content.style.display = 'none';
            icon.className = 'bi bi-chevron-down';
        }
    }
    
    function toggleCommentsSection() {
        const section = document.getElementById('comments-section');
        const icon = document.getElementById('comments-icon');
        
        if (section.style.display === 'none') {
            section.style.display = 'block';
            icon.className = 'bi bi-chevron-up';
        } else {
            section.style.display = 'none';
            icon.className = 'bi bi-chevron-down';
        }
    }
    
    function toggleCalendar() {
        const cal = document.getElementById('calendarSection');
        const btn = document.getElementById('toggleCalendarBtn');
        
        if (cal.style.display === 'none') {
            cal.style.display = 'block';
            btn.innerHTML = '<i class="bi bi-chevron-up"></i> –°–∫—Ä—ã—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å';
        } else {
            cal.style.display = 'none';
            btn.innerHTML = '<i class="bi bi-chevron-down"></i> –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å';
        }
    }
    
    function selectDate(date) {
        window.location.href = `?date=${date}`;
    }
    
    function changeMonth(offset) {
        let date = new Date('{{ today|date:"Y-m-d" }}');
        date.setMonth(date.getMonth() + offset);
        window.location.href = `?date=${date.toISOString().split('T')[0]}`;
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        showSection('today');
    });
</script>
{% endblock %}